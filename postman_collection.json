{
  "info": {
    "name": "Operator-Draft-Escalation",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_postman_id": "d1e2f3a4-b5c6-47d8-9123-d0e1f2a3b4c5"
  },
  "item": [
    {
      "name": "1) Operator assignment notification",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "url": {
          "raw": "{{N8N_BASE_URL}}/{{WEBHOOK_PREFIX}}/operator-assigned",
          "host": ["{{N8N_BASE_URL}}"],
          "path": ["{{WEBHOOK_PREFIX}}", "operator-assigned"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"record_id\": \"pm-001\",\n  \"operator\": { \"email\": \"op@example.com\", \"name\": \"Pat Operator\" },\n  \"notify_channel\": \"email\"\n}"
        }
      }
    },
    {
      "name": "2) Draft pathway flow (intake → pathway → dispatch)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "url": {
          "raw": "{{N8N_BASE_URL}}/{{WEBHOOK_PREFIX}}/incoming",
          "host": ["{{N8N_BASE_URL}}"],
          "path": ["{{WEBHOOK_PREFIX}}", "incoming"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"record_id\": \"pm-002\",\n  \"inquiry\": \"Please propose a go-live plan and parameters for integration.\"\n}"
        }
      }
    },
    {
      "name": "2b) Review decision webhook (approve|edit|reject|escalate)",
      "request": {
        "method": "GET",
        "url": {
          "raw": "{{N8N_BASE_URL}}/{{WEBHOOK_PREFIX}}/review?record_id=pm-002&decision=approve",
          "host": ["{{N8N_BASE_URL}}"],
          "path": ["{{WEBHOOK_PREFIX}}", "review"],
          "query": [
            {"key": "record_id", "value": "pm-002"},
            {"key": "decision", "value": "approve"}
          ]
        }
      }
    },
    {
      "name": "2c) Log meta: pathway_dispatched (w8-meta-log)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "url": {
          "raw": "{{N8N_BASE_URL}}/{{WEBHOOK_PREFIX}}/w8-meta-log",
          "host": ["{{N8N_BASE_URL}}"],
          "path": ["{{WEBHOOK_PREFIX}}", "w8-meta-log"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"action\": \"pathway_dispatched\",\n  \"record_id\": \"pm-002\"\n}"
        }
      }
    },
    {
      "name": "2d) ACK test-mode (no token)",
      "request": {
        "method": "GET",
        "url": {
          "raw": "{{N8N_BASE_URL}}/{{WEBHOOK_PREFIX}}/w10-ack?test=1&record_id=pm-002",
          "host": ["{{N8N_BASE_URL}}"],
          "path": ["{{WEBHOOK_PREFIX}}", "w10-ack"],
          "query": [
            { "key": "test", "value": "1" },
            { "key": "record_id", "value": "pm-002" }
          ]
        }
      }
    },
    {
      "name": "3) Escalation trigger (missing ACK)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "// This request intentionally does nothing;",
              "// Missing ACK is triggered automatically after ACK_TIMEOUT_HOURS by the workflow.",
              "pm.test('Manual step', function () { pm.expect(true).to.be.true; });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "url": {
          "raw": "{{N8N_BASE_URL}}/{{WEBHOOK_PREFIX}}/w8-meta-log",
          "host": ["{{N8N_BASE_URL}}"],
          "path": ["{{WEBHOOK_PREFIX}}", "w8-meta-log"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"action\": \"ack_missing_escalated\",\n  \"record_id\": \"pm-002\"\n}"
        }
      }
    },
    {
      "name": "(Optional) ACK valid token",
      "request": {
        "method": "GET",
        "url": {
          "raw": "{{N8N_BASE_URL}}/{{WEBHOOK_PREFIX}}/w10-ack?token={{ACK_TOKEN}}",
          "host": ["{{N8N_BASE_URL}}"],
          "path": ["{{WEBHOOK_PREFIX}}", "w10-ack"],
          "query": [
            { "key": "token", "value": "{{ACK_TOKEN}}" }
          ]
        }
      }
    },
    {
      "name": "(Negative) ACK invalid token",
      "request": {
        "method": "GET",
        "url": {
          "raw": "{{N8N_BASE_URL}}/{{WEBHOOK_PREFIX}}/w10-ack?token=INVALID",
          "host": ["{{N8N_BASE_URL}}"],
          "path": ["{{WEBHOOK_PREFIX}}", "w10-ack"],
          "query": [
            { "key": "token", "value": "INVALID" }
          ]
        }
      }
    },
    {
      "name": "5) Broadcast webhook (w5-broadcast)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "url": {
          "raw": "{{N8N_BASE_URL}}/{{WEBHOOK_PREFIX}}/w5-broadcast",
          "host": ["{{N8N_BASE_URL}}"],
          "path": ["{{WEBHOOK_PREFIX}}", "w5-broadcast"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"record_id\": \"pm-002\"\n}"
        }
      }
    },
    {
      "name": "9) Draft restyle (w9-rewrite)",
      "request": {
        "method": "GET",
        "url": {
          "raw": "{{N8N_BASE_URL}}/{{WEBHOOK_PREFIX}}/w9-rewrite?draft=Please%20restyle%20this%20text%20into%20a%20concise%20and%20polite%20response.",
          "host": ["{{N8N_BASE_URL}}"],
          "path": ["{{WEBHOOK_PREFIX}}", "w9-rewrite"],
          "query": [
            { "key": "draft", "value": "Please restyle this text into a concise and polite response." }
          ]
        }
      }
    }
  ],
  "variable": [
    { "key": "N8N_BASE_URL", "value": "https://timi2025.app.n8n.cloud" },
    { "key": "WEBHOOK_PREFIX", "value": "webhook" },
    { "key": "ACK_TOKEN", "value": "" }
  ]
}

